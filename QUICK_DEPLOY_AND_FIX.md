# Quick Deployment Guide + Registration Fix

## üî¥ CRITICAL FIX: Registration Endpoint Mismatch

### The Problem
Your frontend is calling `/auth/register-with-store` but your backend controller uses the route `/auth/register-with-store`.

**Backend route (CORRECT):** `POST /auth/register-with-store`  
**Frontend API call:** `POST /auth/register-with-store` ‚úÖ

Actually, the endpoint names match! The issue is likely:
1. **CORS configuration** - Backend not allowing frontend origin
2. **API URL mismatch** - Frontend pointing to wrong backend URL
3. **Missing environment variables** on deployed backend

---

## üöÄ Where to Deploy (FREE Options)

### Option 1: Render.com (RECOMMENDED) ‚≠ê
**Why:** Already configured in `render.yaml`

**URLs from your config:**
- Backend: `https://ecommerce-backend-zlm4.onrender.com`
- Frontend: `https://ecommerce-frontend-3m02.onrender.com`

**Steps:**

1. **Push to GitHub** (if not done):
```bash
cd C:\Users\SHAH HARSH\.gemini\antigravity\scratch\ecommerce-admin-panel
git init
git add .
git commit -m "Production ready with Swagger and E2E tests"
git branch -M main
git remote add origin https://github.com/YOUR_USERNAME/ecommerce-admin-panel.git
git push -u origin main
```

2. **Create Render Account**: https://dashboard.render.com

3. **Deploy using Blueprint**:
   - Click "New" ‚Üí "Blueprint"
   - Connect your GitHub repository
   - Render will read `render.yaml` and create both services automatically

4. **Configure Environment Variables** in Render Dashboard:

**Backend Service** (ecommerce-backend):
```env
DATABASE_URL=postgresql://postgres.xxx:password@aws-0-us-west-1.pooler.supabase.com:6543/postgres?pgbouncer=true
ALLOWED_ORIGINS=https://ecommerce-frontend-3m02.onrender.com
EMAIL_API_KEY=re_R92aaaoo_23rpU3SQgyH5bZz8WxQXt9gU
IMAGEKIT_PUBLIC_KEY=public_zXClHb9aieT2DFsZFgTPW5UfhLE=
IMAGEKIT_PRIVATE_KEY=private_e9/L8lGltcMncQ3w6IoEfH6AoEM=
IMAGEKIT_URL_ENDPOINT=https://ik.imagekit.io/1df8u2pz33
REDIS_URL=rediss://red-d53n0tchg0os738vllq0:PR8jVpcdlEN6vhGVp3Zd8SHib5XGRrbP@oregon-keyvalue.render.com:6379
```

**Frontend Service** will auto-configure from `render.yaml`.

5. **Update CORS after frontend deploys**:
   - Once frontend is live, note its URL
   - Update backend's `ALLOWED_ORIGINS` to include the actual frontend URL
   - Redeploy backend

---

### Option 2: Vercel (Frontend) + Render (Backend)

**Frontend on Vercel:**
```bash
npm install -g vercel
cd frontend
vercel
```

**Backend on Render:** Follow Option 1 for backend only

---

## üîß Fix Registration Issue (For Current Deployment)

Based on conversation history, you had issues with registration. Here's the fix:

### 1. Check Backend Environment Variables

Your backend MUST have these set on Render:

```env
ALLOWED_ORIGINS=https://your-actual-frontend-url.onrender.com
DATABASE_URL=postgresql://... (your Supabase URL with ?pgbouncer=true)
JWT_SECRET=(auto-generated by Render)
ACCESS_TOKEN_SECRET=(auto-generated by Render)
REFRESH_TOKEN_SECRET=(auto-generated by Render)
ENCRYPTION_KEY=ecommerce_admin_panel_master_encryption_key_32_chars
```

### 2. Update Frontend API URL

Check `frontend/.env` or Render environment:
```env
VITE_API_URL=https://ecommerce-backend-zlm4.onrender.com/api/v1
```

### 3. Test Registration Endpoint Manually

```bash
curl -X POST https://ecommerce-backend-zlm4.onrender.com/api/v1/auth/register-with-store \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "TestPass123",
    "firstName": "Test",
    "lastName": "User",
    "storeName": "Test Store",
    "storeSlug": "test-store"
  }'
```

**Expected Success (201):**
```json
{
  "access_token": "eyJhbGc...",
  "refresh_token": "eyJhbGc...",
  "user": {
    "id": "...",
    "email": "test@example.com",
    "storeName": "Test Store"
  }
}
```

**Common Errors:**

‚ùå **CORS Error:**
```
Access to fetch has been blocked by CORS policy
```
**Fix:** Update `ALLOWED_ORIGINS` on backend to include your frontend URL

‚ùå **Database Error:**
```
Can't reach database server
```
**Fix:** Verify `DATABASE_URL` includes `?pgbouncer=true` for Supabase

‚ùå **Validation Error:**
```
Password must be at least 8 characters
```
**Fix:** Use stronger password (8+ chars, uppercase, lowercase, number)

---

## ‚úÖ Deployment Checklist

### Pre-Deployment
- [ ] Code pushed to GitHub
- [ ] `.env` files NOT committed (in `.gitignore`)
- [ ] Build works locally: `npm run build`
- [ ] Tests pass: `npm test`

### Render Deployment
- [ ] Blueprint deployed from `render.yaml`
- [ ] Backend environment variables configured
- [ ] Frontend environment variable (`VITE_API_URL`) set
- [ ] Database `DATABASE_URL` configured with Supabase
- [ ] Backend CORS includes frontend URL

### Post-Deployment
- [ ] Backend health check: `https://your-backend.onrender.com/api/v1/health`
- [ ] Frontend loads: `https://your-frontend.onrender.com`
- [ ] Registration works (test manually)
- [ ] Login works
- [ ] Can create products

---

## üÜò Troubleshooting Registration

### If registration still fails:

1. **Check Browser Console** (F12):
   - Look for CORS errors
   - Check network tab for failed requests
   - Note the actual error message

2. **Check Backend Logs** on Render:
   - Go to your backend service
   - Click "Logs"
   - Look for error when registration is attempted

3. **Verify Database Connection**:
   ```bash
   curl https://your-backend.onrender.com/api/v1/health
   ```
   Should return:
   ```json
   {
     "status": "ok",
     "database": "connected"
   }
   ```

4. **Test with Swagger** (if running locally):
   ```bash
   npm run start:dev
   ```
   Open: `http://localhost:3000/api/docs`
   Try the `/auth/register-with-store` endpoint

---

## üìû Need Help?

If registration still fails, provide:
1. Error message from browser console
2. Error from Render backend logs
3. Response from `/health` endpoint

---

## üéØ Quick Deploy Commands

```bash
# 1. Ensure you're in project root
cd C:\Users\SHAH HARSH\.gemini\antigravity\scratch\ecommerce-admin-panel

# 2. Push to GitHub
git add .
git commit -m "Ready for deployment"
git push origin main

# 3. Go to Render dashboard
# https://dashboard.render.com

# 4. Create Blueprint from your repo
# Render will auto-detect render.yaml

# Done! Your app will deploy automatically
```

---

**Deployment Time:** ~10-15 minutes  
**Cost:** $0/month (free tier)  
**Maintenance:** Auto-deploys on git push
